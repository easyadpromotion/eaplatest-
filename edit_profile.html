<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Update Profile</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background: #f0f2f5; margin: 0; padding: 20px; display: flex; justify-content: center; min-height: 100vh; }
        
        .mobile-screen { 
            background: #ffffff; width: 100%; max-width: 380px; min-height: 100vh; 
            display: flex; flex-direction: column; 
            box-shadow: 0 0 30px rgba(0,0,0,0.1); border-radius: 30px; overflow: hidden;
        }

        /* HEADER */
        .header { 
            background: #ff9800; padding: 20px; color: white; display: flex; align-items: center; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .back-btn { font-size: 24px; text-decoration: none; color: white; margin-right: 15px; }
        .page-title { font-size: 18px; font-weight: 700; }

        /* FORM CONTAINER */
        .form-area { padding: 25px; flex: 1; overflow-y: auto; }
        
        /* PHOTO UPLOAD */
        .photo-section { display: flex; flex-direction: column; align-items: center; margin-bottom: 20px; }
        .profile-preview {
            width: 100px; height: 100px; border-radius: 50%; border: 3px solid #ff9800;
            object-fit: cover; background: #eee; margin-bottom: 10px;
        }
        .upload-btn {
            background: #fff3e0; color: #ff9800; padding: 8px 15px; border-radius: 20px;
            font-size: 12px; font-weight: 600; cursor: pointer; border: 1px solid #ff9800;
        }
        input[type="file"] { display: none; }

        /* INPUT GROUPS */
        .input-group { margin-bottom: 15px; }
        .label { font-size: 12px; font-weight: 600; color: #555; margin-bottom: 5px; display: block; }
        .inp { 
            width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; 
            box-sizing: border-box; font-family: inherit; font-size: 13px; background: #fafafa;
        }
        .inp:focus { border-color: #ff9800; outline: none; background: white; }
        
        /* ROW FOR 2 ITEMS */
        .row { display: flex; gap: 10px; }
        .col { flex: 1; }

        /* SAVE BUTTON */
        .save-btn { 
            width: 100%; background: #ff9800; color: white; padding: 15px; 
            border: none; border-radius: 12px; font-weight: 700; cursor: pointer; 
            font-size: 15px; margin-top: 10px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
            margin-bottom: 30px;
        }
    </style>
</head>
<body onload="loadData()">

<div class="mobile-screen">
    <div class="header">
        <a href="settings.html" class="back-btn">‚Üê</a>
        <span class="page-title">Update Profile</span>
    </div>

    <div class="form-area">
        
        <div class="photo-section">
            <img src="https://via.placeholder.com/100" id="previewImg" class="profile-preview">
            <label for="fileInput" class="upload-btn">üì∑ Upload Photo</label>
            <input type="file" id="fileInput" accept="image/*" onchange="previewFile()">
        </div>

        <div class="row">
            <div class="col input-group">
                <label class="label">First Name</label>
                <input type="text" id="fName" class="inp" placeholder="First Name">
            </div>
            <div class="col input-group">
                <label class="label">Last Name</label>
                <input type="text" id="lName" class="inp" placeholder="Last Name">
            </div>
        </div>

        <div class="row">
            <div class="col input-group">
                <label class="label">DOB (DD-MM-YYYY)</label>
                <input type="date" id="dob" class="inp">
            </div>
            <div class="col input-group">
                <label class="label">Gender</label>
                <select id="gender" class="inp">
                    <option value="">Select</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                </select>
            </div>
        </div>

        <div class="input-group">
            <label class="label">Profession</label>
            <input type="text" id="profession" class="inp" placeholder="e.g. Engineer, Student">
        </div>
        <div class="input-group">
            <label class="label">Sub-Profession</label>
            <input type="text" id="subProfession" class="inp" placeholder="e.g. Software Dev, B.Tech">
        </div>

        <div class="input-group">
            <label class="label">UPI ID</label>
            <input type="text" id="upiId" class="inp" placeholder="example@upi">
        </div>
        <div class="input-group">
            <label class="label">Confirm UPI ID</label>
            <input type="text" id="confirmUpiId" class="inp" placeholder="Re-enter UPI ID">
        </div>

        <button class="save-btn" onclick="saveData()">Update Profile</button>
    </div>
</div>

<script>
    const activeMobile = localStorage.getItem("activeUser");
    let currentPhotoData = ""; // Stores base64 image string

    function loadData() {
        if(!activeMobile) return;
        const user = JSON.parse(localStorage.getItem("userProfile_" + activeMobile)) || {};
        
        // Populate Fields if data exists
        document.getElementById("fName").value = user.firstName || "";
        document.getElementById("lName").value = user.lastName || "";
        document.getElementById("dob").value = user.dob || "";
        document.getElementById("gender").value = user.gender || "";
        document.getElementById("profession").value = user.profession || "";
        document.getElementById("subProfession").value = user.subProfession || "";
        document.getElementById("upiId").value = user.upiId || "";
        document.getElementById("confirmUpiId").value = user.upiId || "";

        // Load Photo
        if(user.profilePic) {
            document.getElementById("previewImg").src = user.profilePic;
            currentPhotoData = user.profilePic;
        }
    }

    // Handle Image Preview & Conversion
    function previewFile() {
        const file = document.querySelector('input[type=file]').files[0];
        const reader = new FileReader();

        reader.onloadend = function () {
            document.getElementById("previewImg").src = reader.result;
            currentPhotoData = reader.result; // Save base64 data
        }

        if (file) {
            reader.readAsDataURL(file);
        }
    }

    function saveData() {
        if(!activeMobile) { alert("Please login first"); return; }

        // Get Values
        const fName = document.getElementById("fName").value;
        const lName = document.getElementById("lName").value;
        const upi = document.getElementById("upiId").value;
        const confirmUpi = document.getElementById("confirmUpiId").value;

        // Validation
        if(upi !== confirmUpi) {
            alert("UPI IDs do not match!");
            return;
        }

        let user = JSON.parse(localStorage.getItem("userProfile_" + activeMobile)) || {};
        
        // Update User Object
        user.firstName = fName;
        user.lastName = lName;
        user.name = fName + " " + lName; // Combine for Dashboard display
        user.dob = document.getElementById("dob").value;
        user.gender = document.getElementById("gender").value;
        user.profession = document.getElementById("profession").value;
        user.subProfession = document.getElementById("subProfession").value;
        user.upiId = upi;
        user.profilePic = currentPhotoData; // Save image data
        
        // Save to LocalStorage
        localStorage.setItem("userProfile_" + activeMobile, JSON.stringify(user));
        
        alert("Profile Updated Successfully!");
        window.location.href = "settings.html"; // Redirect to Settings
    }
</script>

</body>
</html>